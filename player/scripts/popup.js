function getWatchers(t){function e(t){return t&&t.$$watchers||[]}return function t(n){var r=e(n.data().$isolateScope),a=e(n.data().$scope).concat(r);return angular.forEach(n.children(),(function(e){a=a.concat(t(angular.element(e)))})),a}(t=angular.element(t||document.documentElement))}!function(t){"use strict";var e=function(){function t(t){var e=function(t){var e=[" - "," – ","-","–",":"];for(var n in e){var r=e[n],a=t.indexOf(r);if(a>-1)return{index:a,length:r.length}}return null}(t);return null==e?{artist:"",track:""}:function(t,e){return t=t.replace(/^\s+|\s+$/g,""),e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/^\s+|\s+$/g,"")).replace(/^\d+\.\s*/,"")).replace(/\s*\*+\s?\S+\s?\*+$/,"")).replace(/\s*\[[^\]]+\]$/,"")).replace(/\s*\([^\)]*version\)$/i,"")).replace(/\s*\.(avi|wmv|mpg|mpeg|flv)$/i,"")).replace(/\s*(of+icial\s*)?(music\s*)?video/i,"")).replace(/\s*\(\s*of+icial\s*\)/i,"")).replace(/\s*\(\s*[0-9]{4}\s*\)/i,"")).replace(/\s+\(\s*(HD|HQ)\s*\)$/,"")).replace(/\s+(HD|HQ)\s*$/,"")).replace(/\s*video\s*clip/i,"")).replace(/\s+\(?live\)?$/i,"")).replace(/\(\s*\)/,"")).replace(/^(|.*\s)"(.*)"(\s.*|)$/,"$2")).replace(/^(|.*\s)'(.*)'(\s.*|)$/,"$2")).replace(/^[\/\s,:;~-]+/,"")).replace(/[\/\s,:;~-]+$/,""),{artist:t,track:e}}(t.substr(0,e.index),t.substr(e.index+e.length))}return{parse:function(e){var n=t(e.title);return""===n.artist&&(n.track=e.title,n.artist="soundcloudify"),n}}}();window.LastFM=function(){function n(t){var e=[],n="";for(var r in t)t.hasOwnProperty(r)&&e.push(r);e.sort();for(var a=0;a<e.length;a++)"format"!=e[a]&&"callback"!=e[a]&&(n=n+e[a]+t[e[a]]);return md5(n+o)}function r(e,r,o,s,c){r.api_key=i,o&&(r.api_sig=n(r)),r.format="json";var l=[];for(var u in r)r.hasOwnProperty(u)&&l.push(u+"="+encodeURIComponent(r[u]));var d=a+"?"+l.join("&");"GET"===e?t.get(d).done(s).fail(c):"POST"===e?t.post(d).done(s).fail(c):console.error("Unknown method: "+e)}var a="https://ws.audioscrobbler.com/2.0/",i="270d7aec2d7de22c88d90f36c66c9a1a",o="c8a7d4cbfba61e6b777220878bfa8cc1",s=localStorage.getItem("lastfm.sessionKey");return{onAuthSuccess:function(){s=localStorage.getItem("lastfm.sessionKey")},checkTrackInfo:function(t,n,a){var o=e.parse(t);r("GET",{method:"track.getInfo",track:o.track,artist:o.artist,api_key:i},!0,n,a)},updateNowPlaying:function(t,e,n){s?r("POST",{method:"track.updatenowplaying",track:t.track,artist:t.artist,api_key:i,sk:s},!0,e,n):console.log("LastFM: no sessionKey")},scrobble:function(t,e,n){s?r("POST",{method:"track.scrobble","timestamp[0]":t.startTimestamp,"track[0]":t.track,"artist[0]":t.artist,api_key:i,sk:s},!0,e,n):console.log("LastFM: no sessionKey")}}}()}(jQuery),window.TrackItem=React.createClass({displayName:"TrackItem",onClick:function(){this.props.onTrackClick&&this.props.onTrackClick(this.props.track,this.props.trackNumber-1)},onPlayNext:function(){this.props.onPlayNext&&this.props.onPlayNext(this.props.track)},onAddTrackToPlaylist:function(){this.props.onAddTrackToPlaylist&&this.props.onAddTrackToPlaylist(this.props.track)},onRemoveTrack:function(){this.props.onRemoveTrack&&this.props.onRemoveTrack(this.props.track)},onStarTrack:function(){this.props.onStarTrack&&this.props.onStarTrack(this.props.track)},seconds2time:function(t){if(!t)return"N/A";var e=Math.floor(t/3600),n="0"+Math.floor(t%3600/60),r="0"+Math.floor(t%60);return n=n.substr(n.length-2),r=r.substr(r.length-2),isNaN(r)?"00:00":e?e+":"+n+":"+r:n+":"+r},render:function(){var t=this.props.track,e=this.props.context||"nowplaying";if(t){var n,r,a,i;("nowplaying"===e||"playlist"===e)&&(n=React.createElement("i",{className:"remove-btn icon ion-close",onClick:this.onRemoveTrack,title:"Remove"})),"nowplaying"!==e&&(r=React.createElement("i",{className:"add-to-playlist-btn icon ion-log-in",title:"Play Next",onClick:this.onPlayNext})),t.starred?a=React.createElement("div",{className:"starred"},React.createElement("i",{className:"remove-btn icon ion-star",title:"Remove Star",onClick:this.onStarTrack})):i=React.createElement("i",{className:"like-btn icon ion-star",title:"Star",onClick:this.onStarTrack});var o="track-item";return t.error&&(o+=" error"),React.createElement("li",{id:"track-item-"+t.id,className:o},React.createElement("div",{className:"md-tile-left",onClick:this.onClick},React.createElement("div",{className:"face"},React.createElement("img",{src:t.artworkUrl,alt:t.title}))),React.createElement("div",{className:"play-actions",onClick:this.onClick},React.createElement("span",{className:"track-number"},this.props.trackNumber),React.createElement("i",{className:"dynamic-icon icon icon-playing"}),React.createElement("i",{className:"dynamic-icon icon ion-ios-play"}),React.createElement("i",{className:"dynamic-icon icon ion-ios-pause"})),a,React.createElement("div",{className:"md-tile-content"},React.createElement("h3",{onClick:this.onClick},t.title),React.createElement("p",{className:"statistic"},React.createElement("a",{className:"original-link",href:t.originalUrl,title:"View Original"},React.createElement("i",{className:{sc:"brand-icon icon-soundcloud",yt:"brand-icon icon ion-social-youtube-outline"}[t.origin]})),React.createElement("i",{className:"icon ion-headphone"}),React.createElement("span",null,parseInt(t.viewCount).toLocaleString()),React.createElement("i",{className:"icon ion-heart"}),React.createElement("span",null,parseInt(t.likeCount).toLocaleString()),React.createElement("i",{className:"icon ion-clock"}),React.createElement("span",null,this.seconds2time(t.duration)))),React.createElement("div",{className:"md-tile-hover"},i,r,React.createElement("i",{className:"add-to-playlist-btn icon ion-plus",title:"Add to playlist",onClick:this.onAddTrackToPlaylist}),n))}}}),window.TrackList=React.createClass({displayName:"TrackList",propTypes:{tracks:React.PropTypes.array,trackClick:React.PropTypes.string,onTrackClick:React.PropTypes.func,onPlayNext:React.PropTypes.func,onAddTrackToPlaylist:React.PropTypes.func,onStarTrack:React.PropTypes.func,onRemoveTrack:React.PropTypes.func,componentDidUpdate:React.PropTypes.func,listContext:React.PropTypes.string},render:function(){var t=this.props.tracks,e=this.props.onTrackClick,n=this.props.onAddTrackToPlaylist,r=this.props.onRemoveTrack,a=this.props.onStarTrack,i=this.props.onPlayNext,o=this.props.listContext,s=0,c=_.map(t,(function(t){return s++,t?React.createElement(TrackItem,{context:o,key:t.uuid,track:t,trackNumber:s,player:player,onTrackClick:e,onAddTrackToPlaylist:n,onRemoveTrack:r,onStarTrack:a,onPlayNext:i}):void 0}));return React.createElement("ul",{className:"media-list"},c)},componentDidUpdate:function(){this.props.componentDidUpdate&&this.props.componentDidUpdate()}}),function(){"use strict";window.ServiceHelpers=window.ServiceHelpers||{},window.ServiceHelpers.appendTransform=function(t,e){return(t=angular.isArray(t)?t:[t]).concat(e)},window.ServiceHelpers.ID=function(){return"_"+Math.random().toString(36).substr(2,9)};var t=angular.module("soundCloudify",["ngMaterial","ngRoute","ui.router","react","indexedDB"]);t.value("API_ENDPOINT","http://api.getsoundcloudify.com"),t.value("CLIENT_ID","458dac111e2456c40805cd838f4548c1"),t.value("YOUTUBE_KEY","AIzaSyDGbUJxAkFnaJqlTD4NwDmzWxXAk55gFh4"),t.config(["$stateProvider","$urlRouterProvider","$mdThemingProvider","$compileProvider","$httpProvider","$indexedDBProvider","$logProvider",function(t,e,n,r,a,i,o){t.state("nowPlaying",{url:"/now-playing",templateUrl:"partials/nowPlaying.html",controller:"NowPlayingController",controllerAs:"vm"}).state("search",{url:"/search",templateUrl:"partials/search.html",controller:"SearchController"}).state("playlist",{abstract:!0,url:"/playlist",templateUrl:"partials/playlist/playlist.html",controller:"PlaylistController",controllerAs:"playlistCtrl"}).state("playlist.list",{url:"",templateUrl:"partials/playlist/list.html"}).state("playlist.view",{url:"/:playlistIndex",templateUrl:"partials/playlist/view.html",controller:"PlaylistViewController",controllerAs:"playlistViewCtrl"}).state("charts",{abstract:!0,url:"/charts",templateUrl:"partials/charts/charts.html",controller:"ChartsController",controllerAs:"chartsCtrl"}).state("charts.list",{url:"",templateUrl:"partials/charts/list.html"}).state("charts.detail",{url:"/:category",templateUrl:"partials/charts/view.html",controller:"ChartsViewController",controllerAs:"viewCtrl"}),e.otherwise("/charts"),n.definePalette("amazingPaletteName",{50:"ffebee",100:"ffcdd2",200:"ef9a9a",300:"e57373",400:"ef5350",500:"f44336",600:"e53935",700:"d32f2f",800:"c62828",900:"b71c1c",A100:"ff8a80",A200:"ff5252",A400:"ff1744",A700:"d50000",contrastDefaultColor:"light",contrastDarkColors:["50","100","200","300","400","A100"],contrastLightColors:void 0}),n.theme("default").primaryPalette("light-green").dark(),r.imgSrcSanitizationWhitelist(/^\s*((https?|ftp|file|blob|chrome-extension):|data:image\/)/),a.interceptors.push("HttpRequestInterceptor"),i.connection("soundcloudify").upgradeDatabase(1,(function(t,e,n){})),r.debugInfoEnabled(!1),o.debugEnabled(!1)}]),t.run(["$rootScope","GATracker","$location","MigrationService","PlaylistService","StarService","UserService","SyncService",function(t,e,n,r,a,i,o,s){t.$on("$stateChangeSuccess",(function(t){e.trackPageView(n.path())})),a.init(),i.init(),o.init(),s.init(),r.migrate()}]),angular.element(document).ready((function(){setTimeout((function(){angular.bootstrap(document,["soundCloudify"])}),100)}))}(),function(){"use strict";angular.module("soundCloudify").service("CorePlayer",["$rootScope","$window","$mdToast","Messaging","NowPlaying","CLIENT_ID","GATracker","LastFMAuthentication",function(t,e,n,r,a,i,o,s){var c=this,l=chrome.extension.getBackgroundPage();this.nowplaying=a.getTrackIds(),this.state=a.getState(),this.add=function(t,e){e=e||!0,t&&a.addTrack(t).then((function(){e&&c.play(0)}))},this.playNext=function(t){t&&a.addTrack(t,this.state.currentIndex+1)},this.playAll=function(t){a.addTracks(t).then((function(){angular.extend(c.state,{currentTrack:!1,currentIndex:0,playing:!1,currentTime:0,duration:0}),c.play(0)}))},this.remove=function(t){a.removeTrack(t),c.state.currentIndex===t?c.play(t):t<c.state.currentIndex&&c.state.currentIndex--,a.saveState(c.state)},this.clear=function(){a.removeAllTracks().then((function(){angular.extend(c.state,{currentTrack:null,currentIndex:0,playing:!1,currentTime:0,duration:0}),r.sendClearMessage(),a.saveState(c.state)}))},this.play=function(t){t=t||0;var e=this.nowplaying.trackIds[t];if(!e)throw angular.extend(c.state,{currentTrack:null,currentIndex:0,playing:!1,currentTime:0,duration:0}),l.mainPlayer.clear(),a.saveState(c.state),"No track found for playing, index="+t;e&&a.getTrack(e).then((function(e){c.state.playing=!0,c.state.currentTime=0,c.state.duration=0,c.state.currentTrack=e,c.state.currentIndex=t,a.saveState(c.state),l.mainPlayer.play(e)}))},this.pause=function(){this.state.playing=!1,a.saveState(this.state),l.mainPlayer.pause()},this.resume=function(){this.state.playing=!0,a.saveState(this.state),l.mainPlayer.resume()},this.stop=function(){},this.playPause=function(t){return void 0!==t?void(t===this.state.currentIndex&&l.mainPlayer.activePlayer?this.state.playing?this.pause():this.resume():this.play(t)):void(this.state.playing?this.pause():this.resume())},this.next=function(){l.mainPlayer.next()},this.previous=function(){l.mainPlayer.prev()},this.seek=function(t){this.state.currentTime=t*this.state.duration,l.mainPlayer.seek(t)},this.updateState=function(t){this.state.currentTrack||(this.state.currentTrack=t.track,this.state.playing=!0),this.state.currentTime=t.currentTime,this.state.duration=t.duration},this.isPlaying=function(t){return!!this.state.currentTrack&&this.state.currentTrack.id===t};var u=function(t,e){var n=null;return function(){var r=this,a=arguments;clearTimeout(n),n=setTimeout((function(){t.apply(r,a)}),e)}}((function(){a.saveState(c.state)}),500);this.setVolume=function(t){this.state.volume=t,l.mainPlayer.setVolume(t),u()},this.toggleRepeat=function(){0===this.state.repeat?this.state.repeat=1:1===this.state.repeat?this.state.repeat=2:this.state.repeat=0,a.saveState(this.state),o.trackPlayer("toggle repeat",1===this.state.repeat?"all":2===this.state.repeat?"one":"none")},this.toggleShuffle=function(){this.state.shuffle=!this.state.shuffle,a.saveState(this.state),o.trackPlayer("toggle shuffle",this.state.shuffle?"on":"off")},this.toggleScrobble=function(){var t=this;s.isAuth()?(t.state.scrobbleEnabled=!t.state.scrobbleEnabled,a.saveState(t.state),o.trackPlayer("toggle scrobble",this.state.scrobbleEnabled?"on":"off")):s.auth((function(){t.state.scrobbleEnabled=!0,a.saveState(t.state),o.trackPlayer("toggle scrobble",this.state.scrobbleEnabled?"on":"off")}))},this.sendManualScrobble=function(t){this.state.currentTrack.manualTrack=t.track,this.state.currentTrack.manualArtist=t.artist,a.saveState(this.state),r.sendManualScrobbleMessage()},this.markCurrentTrackError=function(){a.markTrackError(this.state.currentTrack),this.next(),o.trackPlayer("track error")},r.registerTimeUpdateHandler((function(e){t.$apply((function(){c.updateState.call(c,e)}))})),r.registerErrorHandler((function(){n.show({templateUrl:"scripts/views/toastError.html",hideDelay:1e3,position:"bottom right",parent:angular.element(document.querySelector("#tab-content"))}),c.markCurrentTrackError()})),r.registerEndedHandler((function(){c.stop()})),r.registerLastFmInvalidHandler((function(){c.state.lastFmInvalid=!0})),r.registerLastFmScrobbledHandler((function(){c.state.scrobbled=!0,c.state.currenTrack.lastFmValidate=!0}))}])}(),soundCloudify=angular.module("soundCloudify"),soundCloudify.controller("MainController",["$http","$location","CLIENT_ID",function(t,e,n){var r=this;this.isLoading=!0,this.getCategories=function(){var e={limit:10,offset:0,linked_partitioning:1,client_id:n};t.get("https://api-v2.soundcloud.com/explore/categories",{params:e}).success((function(t){r.categories=t.music,r.selectedCategory=r.categories[0],r.isLoading=!1}))},this.start=function(){e.path("/playlist/"+r.selectedCategory)},this.getCategories()}]),function(){function t(t,e,n,r){var a=this,i=["nowPlaying","search","playlist.list","charts.list"],o=(localStorage,parseInt(localStorage.getItem("activeTab")));a.selectedIndex=isNaN(o)?3:o,a.onTabSelect=function(){r((function(){localStorage.setItem("activeTab",a.selectedIndex),n.go(i[a.selectedIndex])}))}}angular.module("soundCloudify").controller("DiscoveryController",t),t.$inject=["$scope","$mdSidenav","$state","$timeout"]}(),function(){function t(t,e,n,r,a,i,o,s,c){var l=this;l.playlists=a.getList(),l.starredListLength=o.getLength(),r.$on("starredList.ready",(function(){l.starredListLength=o.getLength()})),l.newPlaylistName="",l.addNew=function(t){13===t.which&&l.newPlaylistName&&a.newPlaylist(l.newPlaylistName).then((function(){l.newPlaylistName="",c.trackPlaylist("add new")}))},l.remove=function(t,e){t.stopPropagation(),a.removePlaylist(e),c.trackPlaylist("remove at",e)},l.playAll=function(e,n){e.stopPropagation();var r=a.getPlaylist(n);return r.tracks.length?(s.playAll(r.tracks),void c.trackPlaylist("play all",n)):void t.show(t.simple().content("No track to play").position("bottom right").parent(angular.element(document.querySelector("#tab-content"))).hideDelay(2e3))},l.playAllListView=function(){r.$broadcast("playlist.playAll")},l.selectPlaylist=function(t){n.go("playlist.view",{playlistIndex:t})},l.openImportModal=function(t){!function(t){function n(t,e){t.newPlaylistName="",t.playlistUrl="",t.invalidUrl=!1,t.playlistNotFound=!1,t.loadedTracks=null,t.loading=!1,t.$watch("playlistUrl",(function(e,n){if(e){t.invalidUrl=!1,t.playlistNotFound=!1,t.loading=!0;var r=i.extractPlaylistId(e);if(!r)return void(e.indexOf("soundcloud.com")>-1?i.resolveSoundCloudPlaylist(e).then((function(e){e.name?(t.newPlaylistName=e.name,t.loadedTracks=e.tracks):t.playlistNotFound=!0,t.loading=!1}),(function(){t.invalidUrl=!0,t.loading=!1})):(t.invalidUrl=!0,t.loading=!1));i.fetchPlaylist(r).then((function(e){e?(t.newPlaylistName=e.name,i.fetchPlaylistItems(r).then((function(e){t.loadedTracks=e,t.loading=!1}))):(t.playlistNotFound=!0,t.loading=!1)}),(function(){t.playlistNotFound=!0,t.loading=!1}))}else t.invalidUrl=!1})),t.createPlaylist=function(){t.newPlaylistName&&a.newPlaylist(t.newPlaylistName,t.loadedTracks||[]).then((function(){e.hide()}))},t.cancel=function(){e.hide()}}var r=angular.element(document.body);e.show({parent:r,targetEvent:t,templateUrl:"scripts/views/import.html",controller:n}),n.$inject=["scope","$mdDialog"]}(t)}}angular.module("soundCloudify").controller("PlaylistController",t),t.$inject=["$mdToast","$mdDialog","$state","$scope","PlaylistService","PlaylistImporter","StarService","CorePlayer","GATracker"]}(),function(){function t(t,e,n,r,a,i,o){var s=this;if(s.playlistIndex=n.playlistIndex,!s.playlistIndex)throw new Error("PlaylistViewController: playlistIndex is undefined");if(s.playlistIndex>=0?(s.listcontext="playlist",s.playlist=r.getPlaylist(s.playlistIndex),s.playlistTracks=_.filter(s.playlist.tracks,(function(t){return!t.deleted}))):(s.listcontext="starredlist",s.playlist={name:"Starred",tracks:[]},a.getTracks().then((function(t){s.playlistTracks=t}))),!s.playlist)throw new Error("PlaylistViewController: playlist not found at index = "+s.playlistIndex);s.backToPlaylist=function(){t.go("playlist.list")},e.$on("playlist.playAll",(function(){s.playlistTracks.length&&(i.playAll(s.playlistTracks),o.trackPlaylist("play all in detail view",playlistIndex))}))}angular.module("soundCloudify").controller("PlaylistViewController",t),t.$inject=["$state","$scope","$stateParams","PlaylistService","StarService","CorePlayer","GATracker"]}(),function(){function t(t,e,n){var r=this;t.getList().then((function(t){r.categories=t})),r.playAll=function(){n.$broadcast("charts.playAll")},r.selectCategory=function(t){e.go("charts.detail",{category:t})},r.sanitizeCategory=function(t){return unescape(t).replace(/\+/g," ")}}angular.module("soundCloudify").controller("ChartsController",t),t.$inject=["Category","$state","$scope"]}(),function(){"use strict";function t(t,n,r,a,i,o,s,c){var l=this;if(l.category=a.category,!l.category)throw new Error("ChartsViewController: category is undefined");l.fallbackArtwork=chrome.extension.getURL("images/artwork-default.jpg"),l.tracks=[],l.paginator=o.getInstance({limit:10,getFirstPage:!0,pagingFunction:function(t){return e.indexOf(l.category)>-1?n.getmeanPlayerCategory(l.category,t):n.getTracks(l.category,t)},pagingSuccess:function(t){l.tracks=l.tracks.concat(t)}}),l.paginator.moreRows(),l.backToTopChart=function(){r.go("charts.list")},t.$on("charts.playAll",(function(){return c.trackDiscovery("play all",l.category),l.tracks.length?(i.playAll(l.tracks),void s.show(s.simple().content("All tracks has been addded to Now Playing list").position("bottom right").parent(angular.element(document.querySelector("#tab-content"))).hideDelay(2e3))):void s.show(s.simple().content("No track to play").position("bottom right").parent(angular.element(document.querySelector("#tab-content"))).hideDelay(2e3))}))}angular.module("soundCloudify").controller("ChartsViewController",t);var e=["reddit","meanPlayer-featured","spotify-global"];t.$inject=["$scope","Category","$state","$stateParams","CorePlayer","Paginator","$mdToast","GATracker"]}(),function(){function t(t,e,n,r,a,i,o,s){var c=this;c.player=i,c.loading=!0,c.tracks=[],t.$on("starredList.ready",(function(){c.tracks&&(c.tracks=o.decorateStar(c.tracks))})),a.getTracks().then((function(t){c.tracks=o.decorateStar(t),c.loading=!1})),c.saveStream=function(t){!function(t){function e(t,e,n){t.newPlaylistName="",t.addNew=function(t){},t.createPlaylist=function(){t.newPlaylistName&&r.newPlaylist(t.newPlaylistName,c.tracks).then((function(){t.newPlaylistName="",e.hide()}))},t.cancel=function(){e.hide()}}var a=angular.element(document.body);n.show({parent:a,targetEvent:t,template:'<md-dialog aria-label="List dialog">  <md-content>    <md-input-container>      <label>New Playlist</label>      <input ng-model="newPlaylistName" type="text" placeholder="Enter playlist name">    </md-input-container>  </md-content>  <div class="md-actions">    <md-button ng-click="cancel()">      Cancel    </md-button>    <md-button class="md-primary" ng-click="createPlaylist()">      Create Playlist    </md-button>  </div></md-dialog>',locals:{player:c.player},controller:e}),e.$inject=["scope","$mdDialog","player"]}(t)},c.clearStream=function(t){var e=n.confirm().title("Would you like clear the current stream?").content("Tips: You might want to save it as a playlist").ok("Please do it!").cancel("No, I don't").targetEvent(t);n.show(e).then((function(){c.tracks=[],c.player.clear()}),(function(){}))}}angular.module("soundCloudify").controller("NowPlayingController",t),t.$inject=["$scope","Category","$mdDialog","PlaylistService","NowPlaying","CorePlayer","TrackAdapter","$timeout"]}(),function(){function t(t,e){t.vm=e,t.$watch("vm.toggle",(function(e,n){t.vm.onToggled(e,n)}),!0),t.$watch("vm.search.term",(function(e,n){e||t.vm.resetSearch()}),!0)}angular.module("soundCloudify").controller("SearchController",t),t.$inject=["$scope","SearchSingleton"]}(),function(){"use strict";function t(t,e,n){return{restrict:"E",templateUrl:"scripts/views/player.html",link:function(r,a,i){r.player=t,r.volume=100*r.player.state.volume,r.openManualScrobble=function(r){function a(t,e,n,r){t.close=function(){e.hide()},t.$on("lastfm.scrobbled",(function(){t.scrobbling=!1,e.hide()})),t.$on("lastfm.scrobbled",(function(){t.scrobbling=!1,t.error="Can not scrobble the track you enter"})),t.sendManualScrobble=function(){t.manualScrobble&&t.manualScrobble.track&&t.manualScrobble.artist&&(t.scrobbling=!0,n.sendManualScrobble(t.manualScrobble),r.trackCustomEvent("lastfm","send manual scrobble"))}}n.trackCustomEvent("lastfm","open manual scrobble"),t.state.scrobbleEnabled&&!t.state.scrobbled&&!0===t.state.lastFmInvalid&&(e.show({parent:angular.element(document.body),targetEvent:r,templateUrl:"scripts/views/manualScrobble.html",controller:a}),a.$inject=["scope","$mdDialog","CorePlayer","GATracker"])},r.doSeek=function(e){var n=e.offsetX/e.target.offsetWidth;t.seek(n)},r.getScrobbleTitle=function(){return t.state.scrobble?!1===t.state.currentTrack.lastFmValidate?"track unregconized by last.fm, right click to edit":t.state.currentTrack.scrobbled?"track has been scrobbled":"last.fm scrobble":"last.fm scrobble"},r.$watch("volume",(function(t){t&&r.player.setVolume(t/100)}))}}}angular.module("soundCloudify").directive("scdPlayer",t),t.$inject=["CorePlayer","$mdDialog","GATracker"]}(),function(){"use strict";angular.module("soundCloudify").directive("loading",(function(){return{restrict:"E",scope:{variation:"@"},templateUrl:"scripts/views/loadingDirective.html",link:function(t){!function(t){t.ver=t.variation||4}(t)}}}))}(),function(){"use strict";function t(t){return{restrict:"EA",transclude:!0,template:'<div class="moving-title" ng-transclude></div>',link:function(e,n,r){function a(){d=!1,c.remove(),n[0].style.marginLeft=0}function i(){d&&u>f?(t(i,30),n[0].style.marginLeft=-f+"px",f++):a()}var o,s,c,l,u,d,f;r.$observe("trackTitle",(function(t){d&&a()})),n.on("mouseover",(function(t){d||(o=n[0].querySelector(".moving-title"),s=o.querySelector("span"),l=o.offsetWidth,u=s.offsetWidth,d=!1,f=0,u>l&&(d=!0,s.style.marginRight="10px",u+=10,c=s.cloneNode(!0),o.appendChild(c),i()))}))}}}angular.module("soundCloudify").directive("trackTitle",t),t.$inject=["$timeout"]}(),function(){"use strict";angular.module("soundCloudify").directive("toggleButton",(function(){return{restrict:"A",link:function(t,e,n){var r="md-primary";n.$observe("toggleButton",(function(t){"true"===t?e.addClass(r):e.removeClass(r)})),e.on("click",(function(){e.toggleClass(r)}))}}}))}(),function(){"use strict";function t(t,e,n){return{restrict:"E",templateUrl:"scripts/views/playlist-menu.html",controller:["$scope","PlaylistService",function(e,r){e.playlists=r.getList(),e.newPlaylistName="",e.addNew=function(t){13===t.which&&e.newPlaylistName&&(r.newPlaylist(e.newPlaylistName),e.newPlaylistName="")},e.remove=function(t){r.removePlaylist(t)},e.addTrackToPlaylist=function(e){if(!t.trackToAdd)throw new Error("No track to add");r.addTrackToPlaylist(t.trackToAdd,e),t.$emit("playlist.menu.close"),n.show(n.simple().content("Track has been added to playlist successfully").position("bottom right").hideDelay(1e3).parent(angular.element(document.querySelector("#tab-content"))))}}]}}function e(t,e){function n(e){i=angular.element('<md-backdrop class="md-dialog-backdrop md-opaque md-default-theme">'),angular.element(document).find("body").append(i),i.on("click",r),s.addClass("open");var n=a();s.css("top",n.top+"px"),s.css("left",n.left+"px"),c=!0,o.parent().addClass("active"),t.trackToAdd=e}function r(){s.removeClass("open"),i.remove(),c=!1,o.parent().removeClass("active")}function a(){var t="",n=e[0].documentElement.getBoundingClientRect(),r=o[0].getBoundingClientRect(),a=s[0].getBoundingClientRect(),i=a.width,c=a.height;t+=r.top-c>=0?"top":"bottom";var l=0,u=0;switch(t+=r.left+r.width+i>n.width?"left":"right"){case"topleft":l=r.top-c,u=r.left-i;break;case"topright":l=r.top-c,u=r.left+r.width;break;case"bottomleft":l=r.top+r.height,u=r.left-i,l+c>n.height&&(l-=l+c-n.height+10);break;case"bottomright":l=r.top+r.height,u=r.left+r.width,l+c>n.height&&(l-=l+c-n.height+10)}return{top:l,left:u}}var i,o,s=angular.element(document.getElementById("singleton-playlist-menu")),c=!1;return t.$on("playlist.menu.close",(function(){c&&r()})),{show:function(t){o=t.element;var e=t.trackToAdd;if(!o)throw new Error("Element is missing when open playlist menu");if(!e)throw new Error("trackToAdd is missing when open playlist menu");n(e)}}}angular.module("soundCloudify").directive("playlistMenu",t).service("$playlistMenu",e),t.$inject=["$rootScope","PlaylistService","$mdToast"],e.$inject=["$rootScope","$document"]}(),function(){"use strict";function t(t){return t("TrackList")}function e(t,e,n,r,a,i,o){return{restrict:"E",templateUrl:"scripts/views/trackList.html",scope:{tracks:"=",trackClick:"&",onTrackClick:"@",listContext:"@",listIndex:"@"},link:function(r,s,c){r.onTrackClick=r.onTrackClick||"playnow",r.componentDidUpdate=function(){r.$emit("componentDidUpdate")},r.showPlaylistMenu=function(e){var n=angular.element(s[0].querySelector("#track-item-"+e.id+" .add-to-playlist-btn"));t.show({element:n,trackToAdd:e}),o.trackDiscovery("add to playlist",r.listContext)},r.handleTrackClick=function(t,n){if("playpause"===r.onTrackClick){if(isNaN(n))throw new Error('track index is not specify or not a number for "playpause"');e.playPause(n),o.trackDiscovery("play - pause",r.listContext,t.title)}else if(r.onTrackClick="playnow"){if(!t)throw new Error("trying to add track, but no track to add");e.add(t,!0),o.trackDiscovery("add track",r.listContext,t.title)}},r.playNext=function(t){e.playNext(t),o.trackDiscovery("up next",r.listContext,t.title),i.show(i.simple().content("Track has been queued up next").position("bottom right").parent(angular.element(document.querySelector("#tab-content"))).hideDelay(1e3))},r.handleRemoveTrack=function(t){var a=_.findIndex(r.tracks,(function(e){return e.uuid===t.uuid}));if("nowplaying"===r.listContext)r.tracks.splice(a,1),e.remove(a);else if("playlist"===r.listContext){if(!r.listIndex)throw new Error("list index undefined");r.tracks.splice(a,1),n.removeTrackFromPlaylist(a,r.listIndex)}o.trackDiscovery("remove track",r.listContext)},r.starTrack=function(t){t.starred=!t.starred,t.starred?o.trackDiscovery("star track",r.listContext):o.trackDiscovery("unstar track",r.listContext),t.starred?a.starTrack(t):a.unstarTrack(t)}}}}angular.module("soundCloudify").directive("trackListReact",t).directive("trackList",e),t.$inject=["reactDirective"],e.$inject=["$playlistMenu","CorePlayer","PlaylistService","NowPlaying","StarService","$mdToast","GATracker"]}(),function(){"use strict";function t(t,e){return{restrict:"A",scope:{},transclude:!0,template:"<div ng-transclude></div>",link:function(t,n,r){function a(){var t=e.state.currentTrack,r=e.state.currentIndex;if(t){angular.element(n[0].querySelector(".playing, .pause")).removeClass("playing pause");var a="playing";e.state.playing||(a="pause"),"index"===i?angular.element(n[0].querySelectorAll(".track-item")[r]).addClass(a):angular.element(n[0].querySelector("#track-item-"+t.id)).addClass(a)}}t.player=e;var i=r.playingTrackAware;t.$on("componentDidUpdate",(function(){a()})),t.$watch("player.state.currentTrack",(function(){a()}),!0),t.$watch("player.state.currentIndex",(function(){a()}),!0),t.$watch("player.state.playing",(function(t){a()}),!0)}}}angular.module("soundCloudify").directive("playingTrackAware",t),t.$inject=["$timeout","CorePlayer"]}(),function(){"use strict";function t(t){return{restrict:"E",template:'<span><md-button title="Donate" ng-click="vm.donate($event)"><md-icon md-font-icon="icon ion-heart"></md-icon></md-button><md-button title="share" ng-click="vm.shareTwitter($event)"><md-icon md-font-icon="icon ion-social-twitter"></md-icon></md-button><md-button title="share" ng-click="vm.shareFacebook($event)"><md-icon md-font-icon="icon ion-social-facebook"></md-icon></md-button><md-button title="about" ng-click="vm.showInformation($event)"><md-icon md-font-icon="icon ion-ios-information"></md-icon></md-button><md-button title="settings" ng-click="vm.openConfigurationDialog($event)"><md-icon md-font-icon="icon ion-gear-b"></md-icon></md-button></span>',scope:{},controller:e,controllerAs:"vm",link:function(e,n){localStorage.getItem("shownDonation129")||t((function(){e.vm.showDonationDialog({target:n.find("button")[0]}),localStorage.setItem("shownDonation129",!0)}),500)}}}function e(t,e,n,r,a){function i(n){function r(e,n){e.close=function(){n.hide()},e.donate=function(){a.trackCustomEvent("donation","click donate button"),t.open("https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=anh%2etrinhtrung%40gmail%2ecom&lc=VN&item_name=meanPlayer%20Chrome%20Extension&currency_code=USD&bn=PP%2dDonationsBF%3abtn_donate_SM%2egif%3aNonHosted")}}var i=angular.element(document.body);a.trackCustomEvent("donation","show donation dialog"),e.show({parent:i,targetEvent:n,templateUrl:"scripts/views/donation.html",controller:r}),r.$inject=["scope","$mdDialog"]}var o=this;o.showDonationDialog=i,n.$on("sync.start",(function(){o.syncing=!0})),n.$on("sync.completed",(function(){o.syncing=!1})),o.openConfigurationDialog=function(t){function n(t,e){chrome.storage.sync.get("scConfig",(function(e){t.configuration=e.scConfig||{showNotification:!0,scrobbleDuration:30}})),t.close=function(){e.hide()},t.save=function(){(!t.configuration.scrobbleDuration||isNaN(t.configuration.scrobbleDuration))&&(t.configuration.scrobbleDuration=30),chrome.storage.sync.set({scConfig:t.configuration}),e.hide()}}var r=angular.element(document.body);e.show({parent:r,targetEvent:t,templateUrl:"scripts/views/configuration.html",controller:n}),n.$inject=["scope","$mdDialog"]},o.showInformation=function(t){function n(t,e){t.close=function(){e.hide()}}var r=angular.element(document.body);e.show({parent:r,targetEvent:t,templateUrl:"scripts/views/info.html",controller:n}),n.$inject=["scope","$mdDialog"]},o.donate=i,o.shareTwitter=function(){var e;e=r.state.currentTrack?"I'm listening to \""+r.state.currentTrack.title+'" with @meanPlayerplayer #meanPlayer https://goo.gl/oybyjt':"#meanPlayer: Sweet YouTube-and-SoundCloud powered music player extension for Chrome  https://goo.gl/oybyjt",t.open("http://twitter.com/intent/tweet?text="+encodeURIComponent(e),"_blank")},o.shareFacebook=function(){t.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent("https://goo.gl/3PnQrL"),"_blank")}}angular.module("soundCloudify").directive("configuration",t),t.$inject=["$timeout"],e.$inject=["$window","$mdDialog","$rootScope","CorePlayer","GATracker"]}(),function(){"use strict";function t(t){return function(e,n,r){var a=t(r.rightClick);n.bind("contextmenu",(function(t){e.$apply((function(){t.preventDefault(),a(e,{$event:t})}))}))}}angular.module("soundCloudify").directive("rightClick",t),t.$inject=["$parse"]}(),function(){"use strict";angular.module("soundCloudify").provider("Paginator",(function(){var t=10;this.setRowsCountPerPage=function(e){t=e},this.$get=[function(){var e=function(t,e){if(!this.isBusy()){var n=this;t=void 0!==t&&t;var r=this.paginationModel;e&&((r=angular.copy(r)).limit=e);var a=this.pagingFunction.call(void 0,r,t);if(!a||!a.then)throw new Error("pagingFunction should return a promise object");a.then((function(e){if(e){var a=e.nextPageToken||"",i=e.tracks;i&&i.length?(n.data=t?n.data.concat(i):i,n.paginationModel.skip+=i.length,n.paginationModel.nextPageToken=a,n.hasMoreRow=i.length===r.limit):n.hasMoreRow=!1,n.pagingSuccess.call(void 0,i,t)}}),(function(){n.pagingFailed.call(void 0)})),this.lastPromise=a}},n=function(n){if(!(n=n||{}).pagingFunction||"function"!=typeof n.pagingFunction)throw"pagingFunction has to be provided as an option when instantiate paginator";this.data=[],this.paginationModel={limit:n.limit||t,skip:n.skip||0,nextPageToken:""},this.hasMoreRow=!0,this.pagingFunction=n.pagingFunction,this.pagingSuccess="function"==typeof n.pagingSuccess?n.pagingSuccess:angular.noop,this.pagingFailed="function"==typeof n.pagingFailed?n.pagingFailed:angular.noop,n.fetchFirstPage&&e.call(this,!1)};return n.prototype={constructor:n,moreRows:function(){e.call(this,!0)},sortBy:function(t){var n;t===this.paginationModel.sort?this.paginationModel.direction=1==this.paginationModel.direction?-1:1:(this.paginationModel.direction=1,this.paginationModel.sort=t),this.paginationModel.limit&&(n=this.paginationModel.skip),this.paginationModel.skip=0,e.call(this,!1,n)},isSortedBy:function(t){return t===this.paginationModel.sort},getSortDirection:function(){return this.paginationModel.direction},isBusy:function(){return this.lastPromise&&0===this.lastPromise.$$state.status},reset:function(){this.paginationModel.skip=0,this.paginationModel.nextPageToken=""}},{getInstance:function(t){return new n(t)}}}]}))}(),angular.module("soundCloudify").filter("scArtwork",(function(){return function(t){return t?-1!==t.indexOf("-large")?t.replace("-large.","-t250x250."):-1!==t.indexOf("default.jpg")?t.replace("default.jpg","hqdefault.jpg"):t:"images/artwork-default.jpg"}})),angular.module("soundCloudify").filter("prettyTime",(function(){return function(t){var e=Math.floor(t/3600),n="0"+Math.floor(t%3600/60),r="0"+Math.floor(t%60);return n=n.substr(n.length-2),r=r.substr(r.length-2),isNaN(r)?"00:00":e?e+":"+n+":"+r:n+":"+r}})),angular.module("soundCloudify").filter("translate",(function(){return function(t){return chrome.i18n.getMessage(t)}})),function(){"use strict";function t(t,e){function n(){}function r(){}function a(){}return n.prototype={constructor:n,getById:function(n){return t((function(t,r){e.openStore("playlist",(function(e){e.find(n).then((function(e){t(e)}),(function(){r()}))}))}))},upsert:function(t){e.openStore("playlist",(function(e){e.upsert(t)}))},insert:function(t){e.openStore("playlist",(function(e){e.insert(t)}))},delete:function(t){e.openStore("playlist",(function(e){Array.isArray(t)?_.each(t,(function(t){e.delete(t)})):e.delete(t)}))},getAllPlaylists:function(){return t((function(t,n){e.openStore("playlist",(function(e){var n=e.query();n.$index("deleted"),n.$eq(0),e.eachWhere(n).then((function(e){t(_.sortBy(e,"order").reverse())}))}))}))},getUnsyncedPlaylists:function(){return t((function(t,n){e.openStore("playlist",(function(e){e.getAll().then((function(e){t(e)}))}))}))}},r.prototype={constructor:r,upsert:function(t){e.openStore("nowplaying",(function(e){Array.isArray(t)?_.each(t,(function(t){e.upsert(t)})):e.upsert(t)}))},insert:function(n){return t((function(t,r){e.openStore("nowplaying",(function(e){Array.isArray(n)?(_.each(n,(function(t){e.insert(t)})),t()):(e.insert(n),t())}))}))},delete:function(t){e.openStore("nowplaying",(function(e){Array.isArray(t)?_.each(t,(function(t){e.delete(t)})):e.delete(t)}))},clear:function(){e.openStore("nowplaying",(function(t){t.clear()}))},getTracks:function(){return t((function(t,n){e.openStore("nowplaying",(function(e){var n=e.query();n.$index("deleted"),n.$eq(0),e.eachWhere(n).then((function(e){t(_.sortBy(e,"order").reverse())}))}))}))},getById:function(n){return t((function(t,r){e.openStore("nowplaying",(function(e){e.find(n).then((function(e){t(e)}))}))}))},increaseOrder:function(n){return t((function(t,r){e.openStore("nowplaying",(function(e){_.each(n,(function(t){e.find(t).then((function(t){t.order+=1,e.upsert(t)}))})),t()}))}))},getUnsyncedTracks:function(){return t((function(t,n){e.openStore("nowplaying",(function(e){var n=e.query();n.$index("sync"),n.$eq(0),e.eachWhere(n).then((function(e){t(e)}))}))}))}},a.prototype={constructor:a,insert:function(t){e.openStore("starred",(function(e){Array.isArray(t)?_.each(t,(function(t){e.insert(t)})):e.insert(t)}))},upsert:function(t){e.openStore("starred",(function(e){Array.isArray(t)?_.each(t,(function(t){e.upsert(t)})):e.upsert(t)}))},delete:function(t){e.openStore("starred",(function(e){Array.isArray(t)?_.each(t,(function(t){e.delete(t)})):e.delete(t)}))},getById:function(n){return t((function(t,r){e.openStore("starred",(function(e){e.find(n).then((function(e){t(e)}))}))}))},getTracks:function(){return t((function(t,n){e.openStore("starred",(function(e){var n=e.query();n.$index("deleted"),n.$eq(0),e.eachWhere(n).then((function(e){t(_.sortBy(e,"order").reverse())}))}))}))},getUnsyncedTracks:function(){return t((function(t,n){e.openStore("starred",(function(e){var n=e.query();n.$index("sync"),n.$eq(0),e.eachWhere(n).then((function(e){t(e)}))}))}))}},{getStorageInstance:function(t){switch(t){case"playlist":return new n;case"nowplaying":return new r;case"starred":return new a}return null}}}angular.module("soundCloudify").service("StorageService",t),t.$inject=["$q","$indexedDB"]}(),function(){"use strict";function t(t){var e,n,r,a,i,o,s=chrome.runtime.connect({name:"soundcloudify"});return s.onMessage.addListener((function(s){var c=s.data;switch(s.message){case"scd.timeupdate":e&&e(c);break;case"scd.ended":n&&n(c);break;case"scd.trackChangedFromBackground":r&&r(c);break;case"scd.error":a&&a();break;case"lastfm.trackInvalid":i&&i();break;case"lastfm.scrobbled":t.$broadcast("lastfm.scrobbled"),o&&o();break;case"lastfm.scrobbleError":t.$broadcast("lastfm.scrobbleError")}})),{registerErrorHandler:function(t){a=t},registerTimeUpdateHandler:function(t){e=t},registerEndedHandler:function(t){n=t},registerTrackChangedFromBackgroundHandler:function(t){r=t},registerLastFmInvalidHandler:function(t){i=t},registerLastFmScrobbledHandler:function(t){o=t},sendPlayMessage:function(t){s.postMessage({message:"scd.play",data:{track:t}})},sendNextMessage:function(){s.postMessage({message:"scd.next"})},sendPrevMessage:function(){s.postMessage({message:"scd.prev"})},sendPauseMessage:function(){s.postMessage({message:"scd.pause"})},sendClearMessage:function(){s.postMessage({message:"scd.clear"})},sendResumeMessage:function(){s.postMessage({message:"scd.resume"})},sendSeekMessage:function(t){s.postMessage({message:"scd.seek",data:{xpos:t}})},sendVolumeMessage:function(t){s.postMessage({message:"scd.volume",data:{volume:t}})},sendLastFmAuthenticationMessage:function(){s.postMessage({message:"lastfm.authentication"})},sendManualScrobbleMessage:function(){s.postMessage({message:"lastfm.manualScrobble"})}}}angular.module("soundCloudify").factory("Messaging",t),t.$inject=["$rootScope"]}(),function(){"use strict";function t(t,e,n,r,a){function i(e,n,a){var i={key:"AIzaSyDGbUJxAkFnaJqlTD4NwDmzWxXAk55gFh4",type:"video",maxResults:e.length,part:["id","snippet","statistics","contentDetails","status"].join(","),fields:["items/id","items/snippet/title","items/snippet/thumbnails","items/statistics/viewCount","items/statistics/likeCount","items/contentDetails/duration","items/status/embeddable"].join(","),id:e.join(",")};t({url:"https://www.googleapis.com/youtube/v3/videos",method:"GET",params:i,transformResponse:ServiceHelpers.appendTransform(t.defaults.transformResponse,(function(t){return t&&t.items?{tracks:r.adaptMultiple(t.items,"yt")}:[]}))}).success((function(t){n(t)})).error((function(){a()}))}var o=JSON.parse(localStorage.getItem("charts"))||[],s={};return{getList:function(){return e((function(e){if(o.length)e(o);else{var r={limit:10,offset:0,linked_partitioning:1,client_id:n};t.get("https://api-v2.soundcloud.com/explore/categories",{params:r}).success((function(t){o=t.music||[],e(o),localStorage.setItem("charts",JSON.stringify(o))}))}}))},getTracks:function(a,i){var o={limit:i.limit,offset:i.skip,linked_partitioning:1,client_id:n};return e((function(e,n){t({url:"https://api-v2.soundcloud.com/explore/"+a,method:"GET",params:o,transformResponse:ServiceHelpers.appendTransform(t.defaults.transformResponse,(function(t){return t&&t.tracks?{tracks:r.adaptMultiple(t.tracks,"sc")}:[]}))}).success((function(t){e(t)})).error((function(){n()}))}))},getmeanPlayerCategory:function(n,r){return e((function(e,o){s[n]&&s[n].length?i(angular.copy(s[n]).splice(r.skip,r.limit),e,o):t({url:a+"/"+n,method:"GET"}).success((function(t){s[n]=t,i(angular.copy(s[n]).splice(r.skip,r.limit),e,o)})).error((function(){o()}))}))}}}angular.module("soundCloudify").service("Category",t),t.$inject=["$http","$q","CLIENT_ID","TrackAdapter","API_ENDPOINT"]}(),function(){"use strict";function t(t,e,n,r,a){return{search:function(n,i){var o={q:n,limit:i.limit,offset:i.skip,linked_partitioning:1,client_id:e};return a((function(e,n){t({url:"https://api-v2.soundcloud.com/search/tracks",method:"GET",params:o,transformResponse:ServiceHelpers.appendTransform(t.defaults.transformResponse,(function(t){return t&&t.collection?{tracks:r.adaptMultiple(t.collection,"sc")}:[]}))}).success((function(t){e(t)})).error((function(){n()}))}))},searchYoutube:function(e,i){var o=a.defer(),s={key:n,type:"video",maxResults:i.limit,pageToken:i.nextPageToken,part:"id",q:e},c="";return t({url:"https://www.googleapis.com/youtube/v3/search",method:"GET",params:s}).success((function(e){e&&e.items||o.resolve([]),c=e.nextPageToken;var a=e.items.map((function(t){return t.id.videoId})),s={key:n,type:"video",maxResults:i.limit,part:["id","snippet","statistics","contentDetails","status"].join(","),fields:["items/id","items/snippet/title","items/snippet/thumbnails","items/statistics/viewCount","items/statistics/likeCount","items/contentDetails/duration","items/status/embeddable"].join(","),id:a.join(",")};t({url:"https://www.googleapis.com/youtube/v3/videos",method:"GET",params:s,transformResponse:ServiceHelpers.appendTransform(t.defaults.transformResponse,(function(t){return t&&t.items?{nextPageToken:c,tracks:r.adaptMultiple(t.items,"yt")}:[]}))}).success((function(t){o.resolve(t)})).error((function(){o.reject()}))})).error((function(){o.reject()})),o.promise}}}angular.module("soundCloudify").service("SearchService",t),t.$inject=["$http","CLIENT_ID","YOUTUBE_KEY","TrackAdapter","$q"]}(),function(){function t(t,e,n,r,a,i,o){function s(t){d=d.concat(t),u.filteredResults=i("filter")(d,c(u.toggle)),0===u.filteredResults.length&&1===u.soundcloudPaginator.lastPromise.$$state.status&&1===u.youtubePaginator.lastPromise.$$state.status&&(u.showNoResultMessage=!0)}function c(t){var e="";if(t)return t.soundcloud&&t.youtube?e="":t.soundcloud?e+="sc":t.youtube&&(e+="yt"),{origin:e}}var l,u=this;u.searchText=null,u.suggest=function(n){return u.showSuggestion?e.suggest(n):t((function(t,e){t([]),u.showSuggestion=!0}))},u.search={term:""},u.showSuggestion=!0,u.recentSearch=JSON.parse(localStorage.getItem("recentSearch"))||[];var d=[];u.toggle=JSON.parse(localStorage.getItem("toggle"))||{soundcloud:!0,youtube:!0},u.player=n,u.filteredResults=[],u.soundcloudPaginator=r.getInstance({limit:10,getFirstPage:!1,pagingFunction:function(t){return a.search(l,t)},pagingSuccess:s}),u.youtubePaginator=r.getInstance({limit:10,getFirstPage:!1,pagingFunction:function(t){return a.searchYoutube(l,t)},pagingSuccess:s}),u.resetSearch=function(){l="",u.filteredResults=[]},u.recentSearchClick=function(t){u.search.term=t,u.selectedItem=t,u.showSuggestion=!1,u.getMore(!0),o.trackSearch("recent search",t)},u.getMore=function(t){if(!t||u.search.term&&u.search.term!==l){var e=angular.copy(u.recentSearch);t?(d=[],u.filteredResults=[],u.showNoResultMessage=!1,u.soundcloudPaginator.reset(),u.youtubePaginator.reset(),e.unshift(u.search.term.trim()),u.recentSearch=_.uniq(e).slice(0,5),localStorage.setItem("recentSearch",JSON.stringify(u.recentSearch)),o.trackSearch("new search",u.search.term),l=u.search.term):o.trackSearch("get more",u.search.term),u.soundcloudPaginator.moreRows(),u.youtubePaginator.moreRows(),u.promises=[u.soundcloudPaginator.lastPromise,u.youtubePaginator.lastPromise]}},u.hasMoreRow=function(){return u.filteredResults.length&&(u.soundcloudPaginator.hasMoreRow||u.youtubePaginator.hasMoreRow)},u.onToggled=function(t,e){localStorage.setItem("toggle",JSON.stringify(t)),u.filteredResults=i("filter")(d,c(t)),t.soundcloud!==e.soundcloud&&o.trackSearch("toggle filter","soundcloud",t.soundcloud?"on":"off"),t.youtube!==e.youtube&&o.trackSearch("toggle filter","youtube",t.youtube?"on":"off")}}angular.module("soundCloudify").service("SearchSingleton",t),t.$inject=["$q","SuggestionService","CorePlayer","Paginator","SearchService","$filter","GATracker"]}(),function(){"use strict";function t(t,e,n,r){return{suggest:function(e){var n={q:e,client:"firefox",ds:"yt"};return r((function(e,r){t({url:"http://suggestqueries.google.com/complete/search",method:"GET",params:n,transformResponse:ServiceHelpers.appendTransform(t.defaults.transformResponse,(function(t){return t&&t[1]?t[1].map((function(t){return{value:t,display:t}})):[]}))}).success((function(t){e(t)})).error((function(){r()}))}))}}}angular.module("soundCloudify").service("SuggestionService",t),t.$inject=["$http","CLIENT_ID","TrackAdapter","$q"]}(),function(){"use strict";function t(t,e,n,r,a,i){function o(){s().then((function(t){var e=_.map(t,(function(t){return t.uuid}));u.trackIds=e,l.mainPlayer.saveTrackIds(e)}))}function s(t){return f.getTracks()}function c(){return e((function(t,e){f.delete(u.trackIds),u.trackIds=[],l.mainPlayer.saveTrackIds([]),t()}))}var l=chrome.extension.getBackgroundPage(),u={trackIds:[]},d=l.mainPlayer.state,f=i.getStorageInstance("nowplaying");return r.$on("sync.completed",(function(){o()})),o(),{getTrackIds:function(){return u},getTrack:function(t){return f.getById(t)},getTracks:s,addTrack:function(t,n){return e((function(e,r){var a;(t=angular.copy(t)).uuid=window.ServiceHelpers.ID(),t.sync=0,t.deleted=0,(a=n&&u.trackIds.length>=1?u.trackIds[n]:u.trackIds[0])?f.getById(a).then((function(r){if(t.order=r.order+1,f.insert(t),void 0!==n){u.trackIds.splice(n,0,t.uuid);var a=_.filter(u.trackIds,(function(t,e){return n>e}));a.length&&f.increaseOrder(a),l.mainPlayer.saveTrackIds(u.trackIds),e()}else u.trackIds.unshift(t.uuid),l.mainPlayer.saveTrackIds(u.trackIds),e()})):(t.order=0,u.trackIds.unshift(t.uuid),f.insert(t),l.mainPlayer.saveTrackIds(u.trackIds),e())}))},addTracks:function(t){return e((function(e,n){c().then((function(){var n=_.map(t,(function(e,n){return(e=angular.copy(e)).uuid=window.ServiceHelpers.ID(),e.sync=0,e.deleted=0,e.order=t.length-1-n,e}));u.trackIds=_.map(n,(function(t){return t.uuid})),l.mainPlayer.saveTrackIds(u.trackIds),f.insert(n),e()}))}))},removeTrack:function(t){var e=u.trackIds[t];f.delete(e),u.trackIds.splice(t,1),l.mainPlayer.saveTrackIds(u.trackIds)},removeAllTracks:c,getState:function(t){return d},saveState:function(t){d=t,l.mainPlayer.saveState(t)},markTrackError:function(t){t.error=!0,f.upsert(t)}}}angular.module("soundCloudify").service("NowPlaying",t),t.$inject=["$http","$q","CLIENT_ID","$rootScope","API_ENDPOINT","StorageService"]}(),function(){"use strict";function t(t,e){if(!t)throw new Error("You have to specify a name when create a playlist");this.tracks=e||[],this.name=t,this.uuid=window.ServiceHelpers.ID(),this.sync=0,this.deleted=0}function e(e,n,r,a,i,o){function s(){u.getAllPlaylists().then((function(t){d.items=t||[]}))}function c(t){if(void 0===t||isNaN(t))throw new Error("Error when remove playlist: index must be specified as number");return d.items[t]}var l,u=o.getStorageInstance("playlist"),d={items:[]};return{init:function(){e.$on("identity.confirm",(function(t,e){e.identity.id&&e.identity.email&&(l=e.identity)})),e.$on("sync.completed",(function(){s()})),s()},getList:function(){return d},newPlaylist:function(e,o){return r((function(r,s){var c=new t(e,o=o||[]);c.order=d.items.length,d.items.unshift(c),u.insert(c),l&&a({url:i+"/playlist",method:"POST",data:c}).success((function(t){if(t.playlist){var e=_.findIndex(d.items,(function(e){return e.uuid=t.playlist.uuid}));d.items[e]=t.playlist,d.items[e].sync=1,u.upsert(d.items[e])}})).error((function(){n.error("error saving playlist")})),r()}))},removePlaylist:function(t){if(void 0===t||isNaN(t))throw new Error("Error when remove playlist: index must be specified as number");var e=c(t);e&&(e.deleted=1,e.sync=0,u.upsert(e),d.items.splice(t,1),l&&e.id&&a({url:i+"/playlist/"+e.id,method:"DELETE"}).success((function(){u.delete(e.uuid),n.info("delete playlist succcessfully")})).error((function(){n.error("delete playlist ecounter an error")})))},getPlaylist:c,addTrackToPlaylist:function(t,e){var r=d.items[e];if(!r)throw new Error("Error when adding track: Playlist not found.");var o=angular.copy(t);o.internalId="",o.uuid=window.ServiceHelpers.ID(),r.tracks.push(o),u.upsert(r),l&&r.id&&a({url:i+"/playlist/"+r.id,method:"PUT",data:{added:[o]}}).success((function(t){n.info("add track success"),t[0]&&t[0][0]&&(o.internalId=t[0][0].internalId,u.upsert(r))})).error((function(){n.error("add track failed")}))},removeTrackFromPlaylist:function(t,e){if(void 0===t||isNaN(t))throw new Error("Error when remove track: trackIndex must be specified as number");var r=d.items[e];if(!r)throw new Error("Error when adding track: Playlist not found.");var o=r.tracks[t];o.deleted=1,u.upsert(r),l&&r.id&&o.internalId&&a({url:i+"/playlist/"+r.id,method:"PUT",data:{added:[],removed:[o.internalId]}}).success((function(e){n.info("remove track success"),r.tracks.splice(t,1)[0],u.upsert(r)})).error((function(){n.error("remove track failed")}))}}}angular.module("soundCloudify").service("PlaylistService",e),e.$inject=["$rootScope","$log","$q","$http","API_ENDPOINT","StorageService"]}(),function(t){"use strict";function e(t,e,n,r,a,i,o){return{fetchPlaylist:function(t){return n((function(n,i){t||(e.error("can not extract playlistId from the input"),i()),r({url:"https://www.googleapis.com/youtube/v3/playlists",method:"GET",params:{key:a,part:"id,snippet",fields:"items/id, items/snippet/title",id:t}}).success((function(t){if(t&&t.items&&t.items.length){var e=t.items[0].snippet.title,r=t.items[0].id;n({id:r,name:e})}else i()})).error((function(){i()}))}))},fetchPlaylistItems:function t(e,i,s){return n((function(t,n){var s={key:a,maxResults:50,part:["id","snippet"].join(","),fields:["nextPageToken","items/snippet/title","items/snippet/thumbnails","items/snippet/resourceId"].join(","),playlistId:e,pageToken:i||""};r({url:"https://www.googleapis.com/youtube/v3/playlistItems",method:"GET",params:s}).success((function(e){e&&e.items&&e.items.length||t([]);var n=[];_.each(e.items,(function(t){t.snippet&&t.snippet.title&&t.snippet.resourceId.videoId&&n.push({id:t.snippet.resourceId.videoId,snippet:{title:t.snippet.title,thumbnails:t.snippet.thumbnails}})})),t({items:o.adaptMultiple(n,"yt"),nextPageToken:e.nextPageToken})})).error((function(){n()}))})).then((function(n){return s=(s||[]).concat(n.items),n.nextPageToken?t(e,n.nextPageToken,s):s}))},extractPlaylistId:function(t){if(t){var n=t.match(/^.*(youtu.be\/|list=)([^#\&\?]*).*/);return n&&n[2]?n[2]:null}e.error("playlist url is missing")},resolveSoundCloudPlaylist:function(t){return n((function(e,n){r({url:"http://api.soundcloud.com/resolve.json",method:"GET",params:{url:t,client_id:i},transformResponse:ServiceHelpers.appendTransform(r.defaults.transformResponse,(function(t){return t&&t.tracks?{name:t.title,tracks:o.adaptMultiple(t.tracks,"sc")}:[]}))}).success((function(t){e(t)})).error((function(){n()}))}))}}}angular.module("soundCloudify").service("PlaylistImporter",e),e.$inject=["$rootScope","$log","$q","$http","YOUTUBE_KEY","CLIENT_ID","TrackAdapter"]}(),function(){"use strict";function t(t,e,n,r,a){function i(){l.getTracks().then((function(e){c=_.map(e,(function(t){return t.id})),t.$broadcast("starredList.ready")}))}function o(t){return c.indexOf(t.id)>-1}var s,c=[],l=a.getStorageInstance("starred");return{init:function(){t.$on("identity.confirm",(function(t,e){e.identity.id&&e.identity.email&&(s=e.identity)})),t.$on("sync.completed",(function(){i()})),i()},getTracks:function(){return l.getTracks()},getLength:function(){return c.length},starTrack:function(t){o(t)||(c.push(t.id),t.internalId="",t.sync=0,t.deleted=0,l.insert(t),s&&e({url:n+"/star",method:"PUT",data:{added:[t],removed:[]}}).success((function(e){e[0]&&e[0][0]?(r.info("star track success"),t.internalId=e[0][0].internalId,t.order=e[0][0].order,t.sync=1,l.upsert(t)):r.error("star track: something wrong")})).error((function(){r.error("star track error")})))},unstarTrack:function(t){var a=t.id,i=c.indexOf(t.id);i>-1&&(c.splice(i,1),l.getById(a).then((function(t){t.internalId?(t.sync=0,t.deleted=1,l.upsert(t),s&&e({url:n+"/star",method:"PUT",data:{added:[],removed:[t.internalId]}}).success((function(e){r.error("star track success"),l.delete(t.id)})).error((function(){r.error("star track error")}))):l.delete(a)})))},isTrackStarred:o}}angular.module("soundCloudify").service("StarService",t),t.$inject=["$rootScope","$http","API_ENDPOINT","$log","StorageService"]}(),function(){"use strict";function t(t){function e(e,o){if(!e)throw new Error("Can not adapt null");var s={};return e.origin===a||o===a?(s.id=e.id,s.title=e.snippet.title,s.artworkUrl=e.snippet.thumbnails&&e.snippet.thumbnails.default&&e.snippet.thumbnails.default.url||r,s.streamUrl=null,s.user="youtube",s.likeCount=e.statistics?e.statistics.likeCount:0,s.dislikeCount=null,s.viewCount=e.statistics?e.statistics.viewCount:0,s.origin=a,s.originalUrl="https://www.youtube.com/watch?v="+e.id+"&source=soundcloudify",s.duration=e.contentDetails?n(e.contentDetails.duration):0):(s.id=e.id,s.title=e.title,s.artworkUrl=e.artwork_url||e.user.avatar_url||r,s.streamUrl=e.stream_url||e.uri+"/stream",s.user=e.user.username,s.likeCount=e.likes_count,s.dislikeCount=null,s.viewCount=e.playback_count,s.origin=i,s.originalUrl=e.permalink_url+"?source=soundcloudify",s.duration=e.duration?n(e.duration/1e3):0),s.uuid=window.ServiceHelpers.ID(),s.starred=t.isTrackStarred(s),s}function n(t){var e=Number(t);if(!isNaN(e))return t;if(t.indexOf("PT")>-1){var n=t.replace("PT","").replace("H",":").replace("M",":").replace("S","");return 3===(n=n.split(":")).length?60*Number(n[0])*60+60*Number(n[1])+Number(n[2]):2===n.length?60*Number(n[0])+Number(n[1]):1===n.length?Number(n[0]):0}}var r="images/artwork-default.jpg",a="yt",i="sc";return{adapt:e,adaptMultiple:function(t,n){return _.filter(_.map(t,(function(t){return t?e(t,n):void 0})),(function(t){return null!=t}))},decorateStar:function(e){return _.filter(_.map(e,(function(e){return e?(e.starred=t.isTrackStarred(e),e):void 0})),(function(t){return null!=t}))}}}angular.module("soundCloudify").service("TrackAdapter",t),t.$inject=["StarService"]}(),function(){"use strict";function t(t){return{trackPageView:function(e){t.ga&&e&&t.ga("send","pageview",{page:e})},trackSearch:function(e,n,r){t.ga&&t.ga("send","event","search",e,n,r)},trackDiscovery:function(e,n,r){t.ga&&t.ga("send","event","discovery",e,n,r)},trackPlayer:function(e,n,r){t.ga&&t.ga("send","event","player",e,n,r)},trackPlaylist:function(e,n,r){t.ga&&t.ga("send","event","playlist",e,n,r)},trackCustomEvent:function(e,n,r,a){t.ga&&t.ga("send","event",e,n,r,a)}}}angular.module("soundCloudify").service("GATracker",t),t.$inject=["$window"]}(),function(){"use strict";function t(t,e){function n(){t({url:a,method:"GET",params:{method:"auth.getToken",api_key:i,format:"json"}}).success((function(t){t.token?(console.log("token: "+t.token),localStorage.setItem("lastfm.token",t.token),c=t.token,r(t.token)):console.log("LastFM.auth: no token key found")})).error((function(){console.log("LastFMAuthentication._requestToken: error")}))}function r(t){var e="https://www.last.fm/api/auth/?api_key="+i+"&token="+t;chrome.tabs.create({active:!0,url:e})}var a="https://ws.audioscrobbler.com/2.0/",i="270d7aec2d7de22c88d90f36c66c9a1a",o="c8a7d4cbfba61e6b777220878bfa8cc1",s=localStorage.getItem("lastfm.sessionKey"),c=localStorage.getItem("lastfm.token");return{auth:function(l){if(c){var u={api_key:i,token:c,method:"auth.getSession",format:"json"};u.api_sig=function(t){var e=[],n="";for(var r in t)t.hasOwnProperty(r)&&e.push(r);e.sort();for(var a=0;a<e.length;a++)"format"!=e[a]&&"callback"!=e[a]&&(n=n+e[a]+t[e[a]]);return md5(n+o)}(u),t({url:a,method:"GET",params:u}).success((function(t){t.session&&t.session.key?(console.log("session key: "+t.session.key),s=t.session.key,c="",localStorage.setItem("lastfm.sessionKey",t.session.key),localStorage.setItem("lastfm.token",""),e.sendLastFmAuthenticationMessage(),l&&l.apply()):4===t.error?n():(t.error=14)&&r(c)})).error((function(){console.log("LastFMAuthentication._requestToken: error")}))}else n()},isAuth:function(){return!!s}}}angular.module("soundCloudify").service("LastFMAuthentication",t),t.$inject=["$http","Messaging"]}(),function(){"use strict";function t(t,e,n){var r={id:"",email:""},a=localStorage.getItem("gid");return{init:function(){chrome.identity.getProfileUserInfo((function(i){r.id=i.id,r.email=i.email,r.id&&r.email&&(t.$broadcast("identity.confirm",{identity:i}),(null===a||"undefined"===a)&&e({url:n+"/signup",method:"POST",data:{gid:r.id,email:r.email}}).success((function(t){t.id&&localStorage.setItem("gid",t.id)})))}))},getUser:function(){return r}}}angular.module("soundCloudify").service("UserService",t),t.$inject=["$rootScope","$http","API_ENDPOINT"]}(),function(){"use strict";function t(t){var e,n=t.get("$rootScope"),r=t.get("API_ENDPOINT");return n.$on("identity.confirm",(function(t,n){n.identity.id&&n.identity.email&&(e=n.identity)})),{request:function(t){return e?(t&&t.url&&0===t.url.indexOf(r)&&(t.headers.uid=e.id),t):t}}}angular.module("soundCloudify").service("HttpRequestInterceptor",t),t.$inject=["$injector"]}(),function(){"use strict";function t(t,e,n,r,a,i,o){function s(){t.$broadcast("sync.start"),t.syncing=!0,c().then(l).then(u)}function c(){return g?(e.debug("SyncService::pull() is in progress"),void reject()):d?(e.debug("SyncService::pull()"),g=!0,n((function(t,e){var n=i+"/data";f&&(n+="?from="+f),r.get(n).success((function(e){if(_.each(e.playlists,(function(t,e){t.deleted?p.delete(t.uuid):(t.uuid||(t.uuid=window.ServiceHelpers.ID()),t.sync=1,_.each(t.tracks,(function(t){t.sync=1})),p.getById(t.uuid).then((function(e){var n=_.filter(e.tracks,(function(t){return!t.internalId}));if(n.length){var r=t.tracks.length?t.tracks[t.tracks.length-1].order:0;_.each(n,(function(t,e){t.order=r+e+1})),(e=t).sync=0,e.tracks=e.tracks.concat(n),p.upsert(e)}else p.upsert(t)}),(function(){p.insert(t)})))})),e.starred.tracks&&e.starred.tracks.length){var n=[],r=[];_.each(e.starred.tracks,(function(t){t.deleted?r.push(t):(t.sync=1,n.push(t))})),m.upsert(n),r.length&&m.delete(_.map(r,(function(t){return t.id})))}t(e.time),g=!0}))}))):(e.debug("SyncService::pull() no user"),void reject())}function l(t){return n((function(a,o){return y?(e.debug("SyncService::push() is in progress"),void o()):d?(e.debug("SyncService::push()"),y=!0,void n.all({unsyncedPlaylists:p.getUnsyncedPlaylists(),unsyncedStarredTracks:m.getUnsyncedTracks()}).then((function(e){var s=e.unsyncedPlaylists,c=e.unsyncedStarredTracks,l=[];_.each(s,(function(t){if(t.id)if(t.deleted)l.push(r({url:i+"/playlist/"+t.id,method:"DELETE"}));else{var e=_.filter(t.tracks,(function(t){return!t.internalId&&!t.deleted})),n=_.filter(t.tracks,(function(t){return t.internalId&&t.deleted}));(e.length||n.length)&&l.push(r({url:i+"/playlist/"+t.id,method:"PUT",data:{added:e,removed:_.map(n,(function(t){return t.internalId}))}}))}else l.push(r({url:i+"/playlist",method:"POST",data:t}))}));var u=_.filter(c,(function(t){return!t.internalId}));u=_.sortBy(u,(function(t){return t.order}));var d=_.filter(c,(function(t){return t.internalId&&1===t.deleted}));u.length||d.length?l.push(r({url:i+"/star",method:"PUT",data:{added:u,removed:_.map(d,(function(t){return t.internalId}))}})):l.push(n((function(t,e){t("star")}))),n.all(l).then((function(e){var n=e.splice(e.length-1,1)[0],r=e;if(_.each(r,(function(e,n){var r=s[n];e.data.playlist?((r=e.data.playlist).sync=1,p.upsert(r),t=e.data.time):r&&e.data.length?(_.each(e.data[0],(function(t,e){var n=_.findWhere(r.tracks,{uuid:t.uuid});n&&(n.internalId=t.internalId)})),r.tracks=_.filter(r.tracks,(function(t){return!t.deleted})),r.sync=1,p.upsert(r),t=e.data[2].time):r.deleted&&(p.delete(r.uuid),t=e.data.time)})),n&&n.data&&n.data.length){_.each(n.data[0],(function(t,e){var n=u[e];n.internalId=t.internalId,n.sync=1})),m.upsert(u);var i=_.map(d,(function(t){return t.id}));m.delete(i),t=n.data[2].time}y=!1,a(t)}),(function(){y=!1,o()}))}))):(e.debug("SyncService::push() no user"),void o())}))}function u(e){e&&(localStorage.setItem("lastSynced",e),t.$broadcast("sync.completed"),t.syncing=!1)}var d,f=localStorage.getItem("lastSynced"),p=o.getStorageInstance("playlist"),m=o.getStorageInstance("starred"),g=!1,y=!1;return{init:function(){t.$on("identity.confirm",(function(t,n){n.identity.id&&(d=n.identity,e.debug("let sync!"),a((function(){s()}),1e3))}))},sync:s,pull:c,push:l,bumpLastSynced:u}}angular.module("soundCloudify").service("SyncService",t),t.$inject=["$rootScope","$log","$q","$http","$timeout","API_ENDPOINT","StorageService"]}(),function(t){"use strict";function e(t,e,n){return{migrate:function(){chrome.storage.local.get("nowPlaying",(function(t){var e=t.nowPlaying||[];e.length&&(n.addTracks(e),chrome.storage.local.set({nowPlaying:[]}))})),chrome.storage.local.get("playlist",(function(n){var r=n.playlist||[];r.length&&(_.each(r,(function(n,r){0===r?_.each(n.tracks,(function(t){e.starTrack(t)})):t.newPlaylist(n.name,n.tracks)})),chrome.storage.local.set({playlist:[]}))}))}}}angular.module("soundCloudify").service("MigrationService",e),e.$inject=["PlaylistService","StarService","NowPlaying"]}(),function(t,e,n,r,a,i,o){t.GoogleAnalyticsObject=a,t.ga=t.ga||function(){(t.ga.q=t.ga.q||[]).push(arguments)},t.ga.l=1*new Date,i=e.createElement(n),o=e.getElementsByTagName(n)[0],i.async=1,i.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(i,o)}(window,document,"script",0,"ga"),ga("create","UA-61308350-1","auto"),ga("set","checkProtocolTask",(function(){})),ga("require","displayfeatures");